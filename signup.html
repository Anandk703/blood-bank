<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sign up - Blood Bank</title>
  <link rel="stylesheet" href="signup.css">
  <style>
    /* small CSS for clarity */
    body{font-family:Arial;padding:20px}
    form{max-width:420px}
    input,select{display:block;margin:8px 0;padding:8px;width:100%}
  </style>
</head>
<body>
    <form id="signupForm">
  <h2>Sign up</h2>
    <input id="name" placeholder="Full name" required />
    <input id="email" type="email" placeholder="Email" required />
    <input id="password" type="password" placeholder="Password (6+)" required />
    <select id="role" required>
      <option value="">-- Choose role --</option>
      <option value="donor">Donor</option>
      <option value="requester">Requester</option>
    </select>
    <select id="bloodGroup" required>
        <option value="">Select Blood Group</option>
        <option value="A+">A+</option>
        <option value="A-">A-</option>
        <option value="B+">B+</option>
        <option value="B-">B-</option>
        <option value="O+">O+</option>
        <option value="O-">O-</option>
        <option value="AB+">AB+</option>
        <option value="AB-">AB-</option>
      </select>
    <input id="phone" type="tel" placeholder="Phone number" required />

    <button type="submit">Sign up</button>
    <br>
  <br>
  Already have account? <a href="login.html">Login</a>
  <br>
  </form>
  <a href="index.html" class="btn">â¬… Back to Home</a>

  
  <!-- common-firebase.js -->
<script type="module">
  // Use the Firebase modular SDK via CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getFirestore, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  // <-- REPLACE with your config from Firebase console
  const firebaseConfig = {
    apiKey: "AIzaSyAVgmIYTi421frp93j9E-EsFeHgphnGVWY",
    authDomain: "blood-bank-bc166.firebaseapp.com",
    projectId: "blood-bank-bc166",
    storageBucket: "blood-bank-bc166.firebasestorage.app",
    messagingSenderId: "958524635543",
    appId: "1:958524635543:web:906255f1e2a8f88d05ecd2",
    measurementId: "G-JVDFV9R9RN"
  };

  export const app = initializeApp(firebaseConfig);
  export const auth = getAuth(app);
  export const db = getFirestore(app);
  export const timestamp = serverTimestamp;
</script>


  <script type="module">
    import './common-firebase.js';
    import { auth, db } from './common-firebase.js';
    import { createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { doc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const form = document.getElementById('signupForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const role = document.getElementById('role').value;
      const bloodGroup = document.getElementById('bloodGroup').value;

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        // save profile displayName
        await updateProfile(cred.user, { displayName: name });

        // Save role & profile in Firestore
        await setDoc(doc(db, 'users', cred.user.uid), {
          name,
          email,
          role,
          bloodGroup,
          phone,
          createdAt: new Date()
        });

        // If donor, add to donors collection
        if (role === 'donor') {
          await setDoc(doc(db, 'donors', cred.user.uid), {
            uid: cred.user.uid,
            name,
            bloodGroup,
            available: true,
            phone ,
            createdAt: new Date()
          });
        }

        // redirect after signup
        if (role === 'donor') location.href = 'donor-dashboard.html';
        else location.href = 'requestor-dashboard.html';

      } catch (err) {
        alert('Error: ' + err.message);
      }
    });
  </script>
</body>
</html>
